(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{114:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var i=n(0),r=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),s=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=s(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),d=s(n),u=i,m=d["".concat(o,".").concat(u)]||d[u]||p[u]||a;return n?r.a.createElement(m,l(l({ref:t},b),{},{components:n})):r.a.createElement(m,l({ref:t},b))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var b=2;b<a;b++)o[b]=n[b];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},77:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return s}));var i=n(3),r=n(7),a=(n(0),n(114)),o={id:"installing",title:"Installation"},l={unversionedId:"installing",id:"installing",isDocsHomePage:!1,title:"Installation",description:"Dependencies",source:"@site/docs/installing.md",slug:"/installing",permalink:"/antlir/docs/installing",editUrl:"https://github.com/facebookincubator/antlir/edit/master/website/docs/installing.md",version:"current",sidebar:"docs",previous:{title:"compiler/",permalink:"/antlir/docs/contributing/todos/compiler"}},c=[{value:"Dependencies",id:"dependencies",children:[{value:"Additional dependencies for re-bootstrapping",id:"additional-dependencies-for-re-bootstrapping",children:[]},{value:"Direnv",id:"direnv",children:[]}]},{value:"Git submodules",id:"git-submodules",children:[]},{value:"Fetch remote artifacts",id:"fetch-remote-artifacts",children:[]},{value:"Test your installation",id:"test-your-installation",children:[{value:"Troubleshooting",id:"troubleshooting",children:[]}]}],b={toc:c};function s(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"dependencies"},"Dependencies"),Object(a.b)("p",null,"Antlir has a relatively small set of dependencies required on the build host."),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"buck")," - Antlir bundles a script to download buck in ",Object(a.b)("inlineCode",{parentName:"li"},"tools/buck")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"java-11-openjdk")," - for ",Object(a.b)("inlineCode",{parentName:"li"},"buck")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"python3 >= 3.7")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"systemd-nspawn")," - usually provided by ",Object(a.b)("inlineCode",{parentName:"li"},"systemd")," or ",Object(a.b)("inlineCode",{parentName:"li"},"systemd-container")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"btrfs-progs")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"libcap-ng-devel")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"gcc")," or ",Object(a.b)("inlineCode",{parentName:"li"},"clang")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"rpm2cpio")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"zstd")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"https://facebook.github.io/watchman/docs/install.html"}),Object(a.b)("inlineCode",{parentName:"a"},"watchman"))," - optional but recommended for faster builds"),Object(a.b)("li",{parentName:"ul"},"a working ",Object(a.b)("inlineCode",{parentName:"li"},"cgroupv2")," setup (first introduced in the 4.5 kernel and already enabled on many modern distros)")),Object(a.b)("h3",{id:"additional-dependencies-for-re-bootstrapping"},"Additional dependencies for re-bootstrapping"),Object(a.b)("p",null,"This should rarely be required as the build appliance shipped with Antlir can\nrebuild itself. However, to rebuild the build appliance using only the host\nsystem, Antlir requires ",Object(a.b)("inlineCode",{parentName:"p"},"dnf")," and/or ",Object(a.b)("inlineCode",{parentName:"p"},"yum")," to be installed on the host."),Object(a.b)("h3",{id:"direnv"},"Direnv"),Object(a.b)("p",null,"Antlir comes with a ",Object(a.b)("inlineCode",{parentName:"p"},".envrc")," for use with ",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"https://direnv.net/"}),Object(a.b)("inlineCode",{parentName:"a"},"direnv")),"\nthat makes some Antlir-related commands easier to use."),Object(a.b)("p",null,"Currently, it simply adds ",Object(a.b)("inlineCode",{parentName:"p"},"tools/")," to your ",Object(a.b)("inlineCode",{parentName:"p"},"$PATH")," when entering the\n",Object(a.b)("inlineCode",{parentName:"p"},"antlir/")," repo directory, which allows you to transparently use the copy of\n",Object(a.b)("inlineCode",{parentName:"p"},"buck")," that Antlir is distributed with. In the future this may be expanded to\noffer more aliases."),Object(a.b)("h2",{id:"git-submodules"},"Git submodules"),Object(a.b)("p",null,"After initial ",Object(a.b)("inlineCode",{parentName:"p"},"git clone")," the repo lacks submodule contents. You need to fetch\nthem (after ",Object(a.b)("inlineCode",{parentName:"p"},"cd")," to repo root) with:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),"$ git submodule update --init\n")),Object(a.b)("h2",{id:"fetch-remote-artifacts"},"Fetch remote artifacts"),Object(a.b)("p",null,"Antlir downloads some dependencies from the internet. It is advised to\ndownload these with ",Object(a.b)("inlineCode",{parentName:"p"},"buck")," before attempting to build any images:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),"buck fetch //...\n")),Object(a.b)("h2",{id:"test-your-installation"},"Test your installation"),Object(a.b)("p",null,"A quick test to confirm that your environment is setup correctly:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),"buck run //images/appliance:stable-build-appliance=container\n")),Object(a.b)("p",null,"This will give you a shell in the container that Antlir uses for container\nbuild operations. If this works you should be ready to build some images by\ngoing back to the ",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"/antlir/docs/getting_started"}),"Getting Started")," page."),Object(a.b)("h3",{id:"troubleshooting"},"Troubleshooting"),Object(a.b)("h4",{id:"cgroupv2"},"cgroupv2"),Object(a.b)("p",null,"The most common case for the above failing is an issue with your host's\ncgroups setup.\nAntlir requires cgroupv2 to be enabled. Many recent distros already have\ncgroupv2 enabled, and others should have guides to do so.\nUsually this is just setting ",Object(a.b)("inlineCode",{parentName:"p"},"systemd.unified_cgroup_hierarchy=1")," on your\nkernel cmdline for ",Object(a.b)("inlineCode",{parentName:"p"},"systemd"),"-based systems so that ",Object(a.b)("inlineCode",{parentName:"p"},"systemd")," will mount\ncgroupv2 at ",Object(a.b)("inlineCode",{parentName:"p"},"/sys/fs/cgroup"),"."),Object(a.b)("h4",{id:"running-buck-as-root"},"Running BUCK as root"),Object(a.b)("p",null,"It is not advised to run BUCK as a root user. If this is done, then mostly\n",Object(a.b)("inlineCode",{parentName:"p"},"buck clean")," has to to be called."),Object(a.b)("p",null,"However, some invocations when running ",Object(a.b)("inlineCode",{parentName:"p"},"buck {build, test, run}")," requires the\nuser to have sudo persmissions without having to enter the password manually.\nThis can be done by ",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"https://linuxize.com/post/how-to-add-user-to-sudoers-in-ubuntu/#adding-user-to-the-sudoers-file"}),"adding the user to the sudoers file"),"."))}s.isMDXComponent=!0}}]);