(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{117:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return v}));var r=t(0),o=t.n(r);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=o.a.createContext({}),u=function(e){var n=o.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=u(e.components);return o.a.createElement(s.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},f=o.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=u(t),f=r,v=p["".concat(i,".").concat(f)]||p[f]||b[f]||a;return t?o.a.createElement(v,l(l({ref:n},s),{},{components:t})):o.a.createElement(v,l({ref:n},s))}));function v(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=f;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<a;s++)i[s]=t[s];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,t)}f.displayName="MDXCreateElement"},77:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return u}));var r=t(3),o=t(7),a=(t(0),t(117)),i={id:"overview",title:"Overview"},l={unversionedId:"concepts/flavors/overview",id:"concepts/flavors/overview",isDocsHomePage:!1,title:"Overview",description:"Introduction to Flavors",source:"@site/docs/concepts/flavors/overview.md",slug:"/concepts/flavors/overview",permalink:"/antlir/docs/concepts/flavors/overview",editUrl:"https://github.com/facebookincubator/antlir/edit/master/website/docs/concepts/flavors/overview.md",version:"current",sidebar:"docs",previous:{title:"Fetched Artifacts",permalink:"/antlir/docs/concepts/pre-built-artifacts/fetched-artifacts"},next:{title:"Inheritance in Parent Layers",permalink:"/antlir/docs/concepts/flavors/inheritance-in-parent-layers"}},c=[{value:"Introduction to Flavors",id:"introduction-to-flavors",children:[]},{value:"Using Flavors",id:"using-flavors",children:[]}],s={toc:c};function u(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"introduction-to-flavors"},"Introduction to Flavors"),Object(a.b)("p",null,"A flavor is a string identifier that controls build configurations.\nOptions contained in a flavor can include ",Object(a.b)("inlineCode",{parentName:"p"},"build_appliance")," as well\nas ",Object(a.b)("inlineCode",{parentName:"p"},"rpm_installer"),"."),Object(a.b)("p",null,"This allows us to specify compability between\ndifferent images. For example, we can make sure that ",Object(a.b)("inlineCode",{parentName:"p"},"centos7")," images\ndo not depend on ",Object(a.b)("inlineCode",{parentName:"p"},"centos8")," images, which is a breaking version."),Object(a.b)("p",null,"It also allows to reuse common build opts throughout the codebase\nwith less duplication."),Object(a.b)("p",null,"Flavors are strings instead of functions because a flavor must have\na stable identity as the source tree evolves. We must be able to\ncompare flavors between old revs and new. The container runtime must\nalso be able to rely on stable flavor IDs. Flavors names must\nfollow two critical rules:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Never change a flavor name"),Object(a.b)("li",{parentName:"ul"},"Never reuse a flavor name")),Object(a.b)("h2",{id:"using-flavors"},"Using Flavors"),Object(a.b)("p",null,"To create a flavor add a mapping to ",Object(a.b)("inlineCode",{parentName:"p"},"antlir/bzl/oss_shim_impl.bzl")),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),'shim = struct(\n    do_not_use_repo_cfg = {\n        "flavor_to_config": {\n            "your_flavor_here": {\n                "build_appliance": "//path/to/your/build/appliance",\n                "rpm_installer": "your_rpm_installer",\n            },\n        },\n    },\n\n)\n')),Object(a.b)("p",null,"Then, you can pass the flavor to images. You can also override the\ndefault value in the flavor with custom ones."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),'image.layer(\n    flavor = "your_flavor_here",\n    flavor_config_overrides = image.opts(\n        build_appliance = "//your/override/build/appliance",\n        rpm_version_set_overrides = [\n            image.rpm.nevra(\n                name = "fuse",\n                epoch = "0",\n                version = "2.9.7",\n                release = "14.fb5",\n                arch = "x86_64",\n            ),\n        ],\n        ...\n    )\n)\n')),Object(a.b)("p",null,"The flavor of an image is written as a string to the file\n",Object(a.b)("inlineCode",{parentName:"p"},"/.meta/flavor")," in the image. This allows you to check the compatibility\nof different layers. We use the flavor file to check the compatibility between cached layers\nbuilt on older revisions and layers built on the current revision. We also use\nthe flavor file to deduce the flavor of the child layer from the parent."))}u.isMDXComponent=!0}}]);